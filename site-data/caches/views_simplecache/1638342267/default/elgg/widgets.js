define("elgg/widgets",['jquery','elgg','elgg/Ajax','jquery-ui/widgets/sortable'],function($,elgg,Ajax){var widgets={};widgets.move=function(event,ui){var guidString=ui.item.attr('id');guidString=guidString.substr(guidString.indexOf('elgg-widget-')+"elgg-widget-".length);var col=ui.item.parent().attr('id');col=col.substr(col.indexOf('elgg-widget-col-')+"elgg-widget-col-".length);var ajax=new Ajax(false);ajax.action('widgets/move',{data:{widget_guid:guidString,column:col,position:ui.item.index()}});};widgets.remove=function(event){event.preventDefault();if(confirm(elgg.echo('deleteconfirm'))===false){return;}
$(this).closest('.elgg-module-widget').remove();var ajax=new Ajax(false);ajax.action($(this).attr('href'));};widgets.collapseToggle=function(event){event.preventDefault();$(this).toggleClass('elgg-widget-collapsed');$(this).parent().parent().find('.elgg-body').slideToggle('medium');};widgets.saveSettings=function(event){event.preventDefault();$(this).parent().slideToggle('medium');var $widgetContent=$(this).parent().parent().children('.elgg-widget-content');$widgetContent.html('<div class="elgg-ajax-loader"></div>');var ajax=new Ajax(false);ajax.action('widgets/save',{data:$(this).serialize(),success:function(result){$widgetContent.html(result.content);if(result.title!==''){var $widgetTitle=$widgetContent.parent().parent().find('.elgg-widget-title');var newWidgetTitle=result.title;if(result.href!==''){newWidgetTitle="<a href='"+result.href+"' class='elgg-anchor'><span class='elgg-anchor-label'>"+newWidgetTitle+"</span></a>";}
$widgetTitle.html(newWidgetTitle);}}});};$('.elgg-widgets').sortable({items:'div.elgg-module-widget.elgg-state-draggable',connectWith:'.elgg-widgets',handle:'.elgg-widget-handle',forcePlaceholderSize:true,placeholder:'elgg-widget-placeholder',opacity:0.8,revert:500,stop:widgets.move});$(document).on('click','a.elgg-widget-delete-button',widgets.remove);$(document).on('submit','.elgg-widget-edit > form ',widgets.saveSettings);$(document).on('click','a.elgg-widget-collapse-button',widgets.collapseToggle);});