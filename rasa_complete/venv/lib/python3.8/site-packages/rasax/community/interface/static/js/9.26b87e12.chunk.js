(this["webpackJsonprasa-frontend"]=this["webpackJsonprasa-frontend"]||[]).push([[9],{2581:function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return H}));var n=r(0),c=r(1),s=r(96),a=r(2),o=r(23),l=r(9),i=r(5),u=r(2281),j=r(1183),d=r(1185),b=r(1184),h=r(2269),x=r(1188),f=r(1187),O=r(217),v=r(2272),m=r(4),p=r(978),w=r(15);function C(e,t){return[].concat(Object(w.a)(e?["read:any"]:[]),Object(w.a)(t?["create:any","update:any","delete:any"]:[]))}function R(e){var t=e.value,r=e.permission,c=e.onChange,s=t.includes("read:any"),a=t.includes("create:any");return Object(n.jsxs)(m.Flex,{py:3,children:[Object(n.jsx)(m.Box,{flex:4,width:4/6,children:Object(n.jsx)(O.a,{children:r.label})}),Object(n.jsx)(m.Box,{flex:1,width:1/6,children:!r.cannotView&&Object(n.jsx)("label",{children:Object(n.jsx)(f.a,{checked:s,onChange:function(){return c(C(!s,a))}})})}),Object(n.jsx)(m.Box,{flex:1,width:1/6,children:!r.cannotModify&&Object(n.jsx)("label",{children:Object(n.jsx)(f.a,{checked:a,onChange:function(){return c(C(s,!a))}})})})]})}function g(e){var t=e.value,r=e.onChange,c=e.permissions;return Object(n.jsxs)(m.Box,{children:[Object(n.jsxs)(m.Flex,{py:3,children:[Object(n.jsx)(m.Box,{flex:4,width:4/6,children:Object(n.jsx)(b.a,{variant:"h3",children:"Permissions"})}),Object(n.jsx)(m.Box,{flex:1,width:1/6,children:Object(n.jsx)(b.a,{variant:"h3",children:"View"})}),Object(n.jsx)(m.Box,{flex:1,width:1/6,children:Object(n.jsx)(b.a,{variant:"h3",children:"Modify"})})]}),c.map((function(e){return Object(n.jsx)(R,{permission:e,value:t[e.resource]||[],onChange:function(n){return r(Object(a.a)(Object(a.a)({},t),{},{[e.resource]:n}))}},e.resource)}))]})}var y,k=r(210),D=r(335);!function(e){e[e.Permissions=0]="Permissions",e[e.Users=1]="Users"}(y||(y={}));var F={role:"",description:"",is_default:!1,grants:{}};function U(e){var t=e.users,r=e.role,o=e.onSaveRole,l=e.onUpdateRole,w=e.onFetchUsers,C=e.permissions,R=Object(s.h)().push,U=c.useState(r||F),B=Object(i.a)(U,2),S=B[0],E=B[1],q=c.useState([]),M=Object(i.a)(q,2),A=M[0],G=M[1],_=c.useState(y.Users),P=Object(i.a)(_,2),L=P[0],N=P[1],K=c.useCallback((function(e){return E(Object(a.a)(Object(a.a)({},S),e))}),[S]);c.useEffect((function(){w({search:"",limit:0,offset:0})}),[w]),c.useEffect((function(){r&&E(r)}),[r]),c.useEffect((function(){G(Object.values(t).filter((function(e){return r&&-1!==e.roles.indexOf(r.role)})).map((function(e){return{label:e.username,value:e.username,data:e}})))}),[r,t,t.length]);var V=c.useMemo((function(){return Object.values(t).map((function(e){return{label:e.username,value:e.username,data:e}}))}),[t]);return Object(n.jsx)(u.a,{scrollable:!0,title:Object(n.jsxs)(n.Fragment,{children:[Object(n.jsx)(p.a,{onClick:function(){return R("/roles")}})," ",r?"Edit":"Create new"," ","Role"]}),rightContent:Object(n.jsxs)(m.Flex,{mr:-2,pr:4,flexDirection:"row-reverse",children:[Object(n.jsxs)(j.a,{variant:"primary",onClick:function(){var e=A.map((function(e){return e.data})),t=function(){R("/roles")},n=Object(a.a)(Object(a.a)({},S),{},{is_default:!!S.is_default});r?l({currentId:r.role,role:n,users:e,onSaved:t}):o({role:n,users:e,onSaved:t})},large:!0,mr:2,children:[r?"Save":"Create"," role"]}),Object(n.jsx)(j.a,{variant:"secondary",onClick:function(){return R("/roles")},large:!0,mr:2,children:r?"Cancel":"Discard"})]}),children:Object(n.jsxs)(m.Box,{width:2/3,m:"0 auto",children:[Object(n.jsxs)(d.a,{sx:{borderRadius:"large"},p:6,mb:6,children:[Object(n.jsx)(b.a,{variant:"h2",mb:4,children:"Basic Details"}),Object(n.jsx)(m.Box,{mb:4,width:"100%",children:Object(n.jsx)(h.a,{text:"Name",children:Object(n.jsx)(x.a,{value:S.role,onChangeValue:function(e){return K({role:e})},fullWidth:!0,placeholder:"Role title",autoFocus:!0})})}),Object(n.jsx)(m.Box,{mb:4,width:"100%",children:Object(n.jsx)(h.a,{text:"Description",children:Object(n.jsx)(x.a,{value:S.description||"",onChangeValue:function(e){return K({description:e})},fullWidth:!0,placeholder:"Access chat logs, analyze and define requirements for updates"})})}),Object(n.jsxs)(m.Flex,{as:"label",alignItems:"center",children:[Object(n.jsx)(f.a,{checked:S.is_default||!1,onChange:function(e){return K({is_default:!S.is_default})},mr:2}),Object(n.jsx)(O.a,{children:"Set as default roles"})]})]}),Object(n.jsxs)(d.a,{sx:{borderRadius:"large"},p:6,children:[Object(n.jsxs)(D.a,{justifyContent:"flex-start",ml:-3,mb:4,children:[Object(n.jsx)(k.a,{variant:"h2",active:L===y.Permissions,onClick:function(){return N(y.Permissions)},children:"Add Permissions"}),Object(n.jsx)(k.a,{variant:"h2",active:L===y.Users,onClick:function(){return N(y.Users)},children:"Add Users"})]}),L===y.Permissions&&Object(n.jsx)(g,{permissions:C,value:S.grants,onChange:function(e){return K({grants:e})}}),L===y.Users&&Object(n.jsx)(h.a,{text:"Add users to this Role",children:Object(n.jsx)(v.a,{placeholder:"Search users...",items:V,onChange:function(e){G(Array.isArray(e)?e:[])},value:A})})]})]})})}var B=r(77),S=r(46),E={onSaveRole:B.f.request,onUpdateRole:B.g.request,onFetchUsers:S.e.request,onFetchRole:B.b.request,onFetchRoleUsers:B.c.request};var q=Object(l.b)((function(e){return{users:e.users.users,permissions:e.roles.permissions,roles:e.roles.roles}}),E)((function(e){var t=e.roles,r=e.onFetchRoleUsers,l=e.onFetchRole,i=Object(o.a)(e,["roles","onFetchRoleUsers","onFetchRole"]),u=Object(s.k)().params.roleName;c.useEffect((function(){u&&(l(u),r(u))}),[l,r,u]);var j=c.useMemo((function(){if(u)return Object.values(t).find((function(e){return e.role===u}))}),[u,t]);return Object(n.jsx)(n.Fragment,{children:Object(n.jsx)(U,Object(a.a)({role:j},i))})})),M=r(118),A=r(58),G=r(2270),_=r(266),P=r(67),L=r(39),N=r(11),K=r(537),V=r(28);function I(e){var t=e.roles,r=e.users,s=e.total,a=e.onLoadMoreRows,o=e.onEdit,l=e.onDelete,i=c.useCallback((function(e){var t=e.dataSelected,r=e.setSelected,c=t.filter((function(e){return e.users_count&&e.users_count>0})).length;return Object(n.jsx)(m.Box,{children:Object(n.jsx)(L.a,{resource:N.d.Roles,action:N.a.Delete,yes:Object(n.jsx)(V.a,{content:c>0?"Cannot perform delete because ".concat(1===c?"the selected role still has":"".concat(c," selected roles still have")," users assigned"):"Delete",children:Object(n.jsx)(j.a,{variant:"inverse",disabled:c>0,onClick:function(){l(t),r([])},children:"Delete"})})})})}),[l]),u=c.useCallback((function(e){var t=e.selected,r=e.onChangeSelected;return function(e){var c=e.rowIndex,s=e.rowData,a=t.includes(c);return Object(n.jsxs)(m.Flex,{children:[Object(n.jsx)(m.Box,{flex:"0 1 auto",children:Object(n.jsx)("label",{children:Object(n.jsx)(f.a,{checked:a,onChange:function(){return r(c,!a)}})})}),Object(n.jsx)(m.Box,{ml:3,flex:"1",children:Object(n.jsx)(O.a,{variant:"bodySecondary",children:s.role})})]})}}),[]),d=c.useCallback((function(){return function(e){var t=e.rowData,c=Object.values(r).filter((function(e){return-1!==e.roles.indexOf(t.role)}));return Object(n.jsx)(G.a,{items:c.map((function(e){return e.username})),placeholder:"No users currently have this role",limit:2})}}),[r]),b=c.useCallback((function(){return function(e){var t=e.rowData;if(!t)return null;var c=Object.values(r).filter((function(e){return-1!==e.roles.indexOf(t.role)}));return Object(n.jsxs)(m.Flex,{flexDirection:"row-reverse",mr:-1,children:[Object(n.jsx)(L.a,{resource:N.d.Roles,action:N.a.Delete,yes:0===c.length?Object(n.jsx)(V.a,{content:"Delete",children:Object(n.jsx)(j.a,{mx:1,onClick:function(){l([t])},variant:"icon",children:Object(n.jsx)(_.a,{icon:A.faTrashAlt})})}):Object(n.jsx)(m.Box,{mx:1,flex:"0 0 40px"})}),Object(n.jsx)(L.a,{resource:N.d.Roles,action:N.a.Update,yes:Object(n.jsx)(V.a,{content:"Edit",children:Object(n.jsx)(j.a,{mx:1,onClick:function(){o(t)},variant:"icon",children:Object(n.jsx)(_.a,{icon:M.faEdit})})})})]})}}),[r,o,l]);return Object(n.jsx)(K.a,{total:s,bulkActionsRenderer:i,data:t,resource:N.d.Roles,onLoadMoreRows:a,children:function(e){return[Object(n.jsx)(P.b,{cellDataGetter:function(){},flexGrow:2,width:2/6,dataKey:"role",label:"Role",cellRenderer:u(e)},"role"),Object(n.jsx)(P.b,{cellDataGetter:function(){},flexGrow:3,width:2/6,dataKey:"role",label:"Description",cellRenderer:function(e){var t=e.rowData;return Object(n.jsx)(O.a,{variant:"bodySecondary",children:t.description||"No description"})}},"description"),Object(n.jsx)(P.b,{cellDataGetter:function(){},flexGrow:3,width:1/6,dataKey:"role",label:"Users",cellRenderer:d()},"users"),Object(n.jsx)(P.b,{cellDataGetter:function(){},flexGrow:1,width:1/6,dataKey:"role",label:"",cellRenderer:b()},"role")]}})}function J(e){var t=e.roles,r=e.users,a=e.total,o=e.onLoadMoreRows,l=e.onFetchUsers,i=e.onDeleteRole,d=Object(s.h)().push,b=c.useCallback((function(e){return d("/roles/".concat(e.role))}),[d]);return c.useEffect((function(){o({search:"",offset:0,limit:0}),l({search:"",offset:0,limit:0})}),[o,l]),Object(n.jsx)(u.a,{title:"Roles",rightContent:Object(n.jsx)(j.a,{variant:"primary",large:!0,onClick:function(){return d("/roles/create")},mr:4,children:"Create new role"}),children:Object(n.jsx)(I,{roles:t,users:r,total:a,onLoadMoreRows:o,onEdit:b,onDelete:i})})}var W=r(16),z={onFetchUsers:S.e.request,onFetchRoles:B.d.request,onDeleteRole:B.a.request};var T=Object(l.b)((function(e){return{roles:e.roles.roles,users:e.users.users,total:e.roles.total,userRole:e.auth.role}}),z)((function(e){var t=Object(W.g)(B.d);return Object(n.jsx)(J,Object(a.a)(Object(a.a)({},e),{},{onLoadMoreRows:t}))}));function H(e){var t=Object(W.k)();c.useEffect((function(){t("view:roles:loaded")}),[t]);var r=Object(s.k)();return Object(n.jsxs)(s.e,{children:[Object(n.jsx)(s.c,{exact:!0,path:r.path,component:T}),Object(n.jsx)(s.c,{exact:!0,path:"".concat(r.path,"/create"),component:q}),Object(n.jsx)(s.c,{exact:!0,path:"".concat(r.path,"/:roleName"),component:q})]})}}}]);